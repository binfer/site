<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="smoke">
  <meta name="description" content="smoke.mvp">
  <meta name="keywords" content="smoke">
  
  <link rel="prev" href="/blog/other/risk-control-safe-rule/" />
  <link rel="next" href="/blog/go/%E4%BD%8D%E8%BF%90%E7%AE%97/" />
  <link rel="canonical" href="/blog/php/temegram-php-message/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Temegram Php Message | smoke
       
  </title>
  <meta name="title" content="Temegram Php Message | smoke">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": ""
    },
    "articleSection" : "blog",
    "name" : "Temegram Php Message",
    "headline" : "Temegram Php Message",
    "description" : "telegram php \x26lt;?php namespace App\\Repositories; use GuzzleHttp\\Client; use GuzzleHttp\\Psr7\\Response; use Illuminate\\Support\\Facades\\Log; \/\/ 申请bot,建立订阅通道，建立组，管理订阅通道和组，将bot拉入组内 class TelegramRepository extends BaseRepository { static public $curl; protected $list; public $id, $first_name; public function __construct(){ if (!self::$curl) self::$curl = new Client([\x26#39;base_uri\x26#39; =\x26gt; \x26#34;https:\/\/api.telegram.org\/bot\x26#34;.config(\x26#39;other.telegram\x26#39;).\x26#34;\/\x26#34;]); } public function make() { $result = self::$curl-\x26gt;get(\x26#34;getUpdates\x26#34;, [\x26#39;verify\x26#39; =\x26gt; false]); $this-\x26gt;list = $result-\x26gt;getBody()-\x26gt;getContents(); return $this; } public function one($index=0, $field=\x26#39;chat\x26#39;) { if ($this-\x26gt;list) { $data = json_decode($this-\x26gt;list, true); if (is_array($data)) { if (isset($data[\x26#39;result\x26#39;][$index])) { \/\/chat针对组  $info = $data[\x26#39;result\x26#39;][$index][\x26#39;message\x26#39;][$field]; foreach ($info as $k=\x26gt;$v) { $this-\x26gt;$k = $v; } } } } return $this; } public function push(string $message = \x26#39;\x26#39;, callable $call=null) { if ($call)$call($this); $msg = array( \x26#39;位置 : \x26#39;.",
    "inLanguage" : "en-us",
    "author" : "smoke",
    "creator" : "smoke",
    "publisher": "smoke",
    "accountablePerson" : "smoke",
    "copyrightHolder" : "smoke",
    "copyrightYear" : "2019",
    "datePublished": "2019-11-30 13:10:08 \x2b0800 CST",
    "dateModified" : "2019-11-30 13:10:08 \x2b0800 CST",
    "url" : "\/blog\/php\/temegram-php-message\/",
    "wordCount" : "164",
    "keywords" : [ "php", "smoke"]
}
</script>

</head>

  


<link href="/css/awesome.min.css" type="application/rss+xml" />
<script src="/js/jquery.min.js" async=""></script>
<script src="/js/autoload.js" async=""></script>

  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="">smoke</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/blog/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="">smoke</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/blog/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Temegram Php Message</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="" rel="author">smoke</a> with ♥ 
                <span class="post-time">
                on <time datetime=2019-11-30 itemprop="datePublished">November 30, 2019</time>
                </span>
                in
                
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          <h4 id="httpsimgshieldsiostaticv1labelsmokemessagetemegram-php-messagecoloryellowgreenstylefor-the-badgelogoappveyorsuffixdownloadlinkhttpleftlinkhttpgooglecom"><img src="https://img.shields.io/static/v1?label=smoke&amp;message=%3CTemegram-Php-Message%3E&amp;color=yellowgreen&amp;style=for-the-badge&amp;logo=appveyor&amp;suffix=download&amp;?link=http://left&amp;link=http://google.com" alt="*"></h4>
<h2 id="telegram-php">telegram php</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">
<span style="color:#75715e">&lt;?php</span>

<span style="color:#66d9ef">namespace</span> <span style="color:#a6e22e">App\Repositories</span>;


<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">GuzzleHttp\Client</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">GuzzleHttp\Psr7\Response</span>;
<span style="color:#66d9ef">use</span> <span style="color:#a6e22e">Illuminate\Support\Facades\Log</span>;

<span style="color:#75715e">// 申请bot,建立订阅通道，建立组，管理订阅通道和组，将bot拉入组内
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TelegramRepository</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">BaseRepository</span>
{

    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">public</span> $curl;
    <span style="color:#66d9ef">protected</span> $list;
    <span style="color:#66d9ef">public</span> $id, $first_name;
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __construct(){
        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">self</span><span style="color:#f92672">::</span>$curl)
            <span style="color:#a6e22e">self</span><span style="color:#f92672">::</span>$curl <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Client</span>([<span style="color:#e6db74">&#39;base_uri&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;https://api.telegram.org/bot&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">config</span>(<span style="color:#e6db74">&#39;other.telegram&#39;</span>)<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;/&#34;</span>]);
    }


    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">make</span>() {
        $result <span style="color:#f92672">=</span> <span style="color:#a6e22e">self</span><span style="color:#f92672">::</span>$curl<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;getUpdates&#34;</span>, [<span style="color:#e6db74">&#39;verify&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">false</span>]);
        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">list</span> <span style="color:#f92672">=</span> $result<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getBody</span>()<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getContents</span>();
        <span style="color:#66d9ef">return</span> $this;
    }


    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">one</span>($index<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, $field<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;chat&#39;</span>) {
        <span style="color:#66d9ef">if</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">list</span>) {
            $data <span style="color:#f92672">=</span> <span style="color:#a6e22e">json_decode</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">list</span>, <span style="color:#66d9ef">true</span>);
            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is_array</span>($data)) {
                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($data[<span style="color:#e6db74">&#39;result&#39;</span>][$index])) {
                    <span style="color:#75715e">//chat针对组
</span><span style="color:#75715e"></span>                    $info <span style="color:#f92672">=</span> $data[<span style="color:#e6db74">&#39;result&#39;</span>][$index][<span style="color:#e6db74">&#39;message&#39;</span>][$field];
                    <span style="color:#66d9ef">foreach</span> ($info <span style="color:#66d9ef">as</span> $k<span style="color:#f92672">=&gt;</span>$v) {
                        $this<span style="color:#f92672">-&gt;</span>$k <span style="color:#f92672">=</span> $v;
                    }
                }
            }
        }
        <span style="color:#66d9ef">return</span> $this;
    }

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">string</span> $message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#a6e22e">callable</span> $call<span style="color:#f92672">=</span><span style="color:#66d9ef">null</span>) {

       <span style="color:#66d9ef">if</span> ($call)$call($this);
       $msg <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(
           <span style="color:#e6db74">&#39;位置 : &#39;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">get_called_class</span>(),
           <span style="color:#e6db74">&#39;时间 : &#39;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">date</span>(<span style="color:#e6db74">&#34;Y-m-d H:i:s&#34;</span>),
           <span style="color:#e6db74">&#39;事件 : &#39;</span><span style="color:#f92672">.</span>$message
       );
       $request <span style="color:#f92672">=</span> [
           <span style="color:#e6db74">&#39;query&#39;</span>  <span style="color:#f92672">=&gt;</span> [
               <span style="color:#e6db74">&#39;chat_id&#39;</span>    <span style="color:#f92672">=&gt;</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">id</span>,
               <span style="color:#e6db74">&#39;text&#39;</span>       <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">join</span>(<span style="color:#a6e22e">PHP_EOL</span>,$msg),
               ],
           <span style="color:#e6db74">&#39;verify&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">false</span>
       ];
       $result <span style="color:#f92672">=</span> <span style="color:#a6e22e">self</span><span style="color:#f92672">::</span>$curl<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#34;sendMessage&#34;</span>, $request);
       $status <span style="color:#f92672">=</span> $result<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getStatusCode</span>();

       <span style="color:#66d9ef">if</span> ($status <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>) <span style="color:#a6e22e">Log</span><span style="color:#f92672">::</span><span style="color:#a6e22e">notice</span>(<span style="color:#e6db74">&#34;telegram 发送失败.&#34;</span>);

    }



    <span style="color:#75715e">// 快捷执行
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">execute</span>(<span style="color:#a6e22e">string</span> $message<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#a6e22e">int</span> $index<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>) {

        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">make</span>()<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">one</span>($index)<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">push</span>($message);
        <span style="color:#75715e">//$this-&gt;push($message, function (&amp;$self) use($index) {$self-&gt;make()-&gt;one($index);});
</span><span style="color:#75715e"></span>
    }
}

</code></pre></div>
    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>smoke </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=/blog/php/temegram-php-message/>/blog/php/temegram-php-message/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                #
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="tags/php/">
                    #php</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="/blog/other/risk-control-safe-rule/" class="prev" rel="prev" title="Risk Control Safe Rule"><i class="iconfont icon-left"></i>&nbsp;Risk Control Safe Rule</a>
         
        
        <a href="/blog/go/%E4%BD%8D%E8%BF%90%E7%AE%97/" class="next" rel="next" title="位运算">位运算&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="">smoke</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
